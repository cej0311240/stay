{"ast":null,"code":"import supabase from\"./supabaseClient\";/* =====================================================\n    ✅ 관리자 공통 상수\n    - 여러 API에서 같은 값 쓰면 여기서 통일\n    ===================================================== */const UNIT_PRICE=1500;/* =====================================================\n    관리자 헤더\n    ===================================================== *//**\n     * ✅ [관리자 페이지 상단 Header]\n     * - 관리자 이름 표시 (profiles.user_name)\n     * - user_type이 ADMIN인지 체크\n     *\n     * ✅ 사용 예시\n     * const header = await fetchAdminHeader(adminProfileId);\n     * // header.role_label -> \"관리자\"\n     * // header.admin_name -> \"홍길동\"\n     */export const fetchAdminHeader=async adminProfileId=>{const{data,error}=await supabase.from(\"profiles\").select(\"id, user_name, user_type\").eq(\"id\",adminProfileId).single();if(error)throw error;// ✅ 안전장치: 관리자 계정만 접근\nif(data.user_type!==\"ADMIN\"){throw new Error(\"관리자 계정이 아닙니다.\");}return{role_label:\"관리자\",admin_name:data.user_name};};/* =====================================================\n    승인요청 리스트 / 승인 처리\n    ===================================================== *//**\n     * ✅ [관리자 페이지 - 승인요청 리스트]\n     * - 가입했지만 승인 안 된 사용자 목록\n     * - profiles.is_approved = false 인 행들\n     *\n     * ✅ 사용 예시\n     * const list = await fetchApprovalRequests();\n     * // list.map(card => card.user_name ...)\n     */export const fetchApprovalRequests=async()=>{const{data,error}=await supabase.from(\"profiles\").select(\"id, user_type, user_name, dong_ho, car_num, add_car, is_approved, created_at\").eq(\"is_approved\",false).order(\"created_at\",{ascending:false});if(error)throw error;return(data||[]).map(row=>{var _row$add_car,_row$created_at$slice,_row$created_at;return{profile_id:row.id,user_type:row.user_type,user_name:row.user_name,dong_ho:row.dong_ho,car_num:row.car_num,add_car:(_row$add_car=row.add_car)!==null&&_row$add_car!==void 0?_row$add_car:null,created_at:(_row$created_at$slice=(_row$created_at=row.created_at)===null||_row$created_at===void 0?void 0:_row$created_at.slice(0,10))!==null&&_row$created_at$slice!==void 0?_row$created_at$slice:null// 날짜만\n};});};/**\n     * ✅ [관리자 페이지 - 승인 버튼]\n     * - 해당 사용자 profiles.is_approved = true 로 변경\n     *\n     * ✅ 사용 예시\n     * await approveProfile(profileId);\n     * // 이후 fetchApprovalRequests() 다시 호출해서 화면 갱신\n     */export const approveProfile=async profileId=>{const{error}=await supabase.from(\"profiles\").update({is_approved:true}).eq(\"id\",profileId);if(error)throw error;return true;};/* =====================================================\n    상가 정산 리스트 / 정산 승인\n    ===================================================== *//**\n     * ✅ [관리자 페이지 - 상가 정산 리스트(카드 여러 개)]\n     * - parking_discounts.discount_sum > 0 인 상가만 보여줌\n     * - (DB에 \"정산요청 상태\" 컬럼이 없어서) 누적이 있으면 '정산 대상'으로 간주\n     *\n     * ✅ 사용 예시\n     * const cards = await fetchAdminSettlementList();\n     * // cards를 map으로 카드 UI 렌더링\n     */export const fetchAdminSettlementList=async()=>{const{data,error}=await supabase.from(\"parking_discounts\").select(\"\\n        profile_id,\\n        discount_sum,\\n        created_at,\\n        profiles (\\n            user_name,\\n            user_type\\n        )\\n        \").gt(\"discount_sum\",0);// ✅ 누적 있는 상가만\nif(error)throw error;const today=new Date().toISOString().slice(0,10);return(data||[]).filter(r=>{var _r$profiles;return((_r$profiles=r.profiles)===null||_r$profiles===void 0?void 0:_r$profiles.user_type)===\"STORE\";}).map(r=>{var _r$discount_sum,_r$profiles$user_name,_r$profiles2;const qty=(_r$discount_sum=r.discount_sum)!==null&&_r$discount_sum!==void 0?_r$discount_sum:0;return{store_profile_id:r.profile_id,store_name:(_r$profiles$user_name=(_r$profiles2=r.profiles)===null||_r$profiles2===void 0?void 0:_r$profiles2.user_name)!==null&&_r$profiles$user_name!==void 0?_r$profiles$user_name:\"(상가)\",// ✅ DB에 \"기간\"이 없으므로: 최근 created_at(정산일로 사용) ~ 오늘\nfrom_date:r.created_at?r.created_at.slice(0,10):null,to_date:today,qty,unit_price:UNIT_PRICE,amount:qty*UNIT_PRICE};});};/**\n     * ✅ [관리자 페이지 - 정산 승인 버튼]\n     * - 승인하면 해당 상가 discount_sum을 0으로 초기화\n     * - created_at을 now로 바꿔서 \"최근 정산일\"처럼 사용\n     *\n     * ✅ 사용 예시\n     * const res = await approveSettlement(storeProfileId);\n     * if(res.ok) alert(\"정산 승인 완료\");\n     * // 이후 fetchAdminSettlementList() 재호출\n     */export const approveSettlement=async storeProfileId=>{var _data$discount_sum;// 1) 현재 누적 조회 (0이면 승인할 게 없음)\nconst{data,error:readErr}=await supabase.from(\"parking_discounts\").select(\"discount_sum\").eq(\"profile_id\",storeProfileId).maybeSingle();if(readErr)throw readErr;const qty=(_data$discount_sum=data===null||data===void 0?void 0:data.discount_sum)!==null&&_data$discount_sum!==void 0?_data$discount_sum:0;if(qty===0){return{ok:false,message:\"정산할 내역이 없습니다.\"};}// 2) 정산 처리 (초기화)\nconst nowIso=new Date().toISOString();const{error:updErr}=await supabase.from(\"parking_discounts\").update({discount_sum:0,created_at:nowIso}).eq(\"profile_id\",storeProfileId);if(updErr)throw updErr;// 3) 관리자 화면에서 보여줄 결과값\nreturn{ok:true,settled_qty:qty,settled_amount:qty*UNIT_PRICE,settled_date:nowIso.slice(0,10)};};","map":{"version":3,"names":["supabase","UNIT_PRICE","fetchAdminHeader","adminProfileId","data","error","from","select","eq","single","user_type","Error","role_label","admin_name","user_name","fetchApprovalRequests","order","ascending","map","row","_row$add_car","_row$created_at$slice","_row$created_at","profile_id","id","dong_ho","car_num","add_car","created_at","slice","approveProfile","profileId","update","is_approved","fetchAdminSettlementList","gt","today","Date","toISOString","filter","r","_r$profiles","profiles","_r$discount_sum","_r$profiles$user_name","_r$profiles2","qty","discount_sum","store_profile_id","store_name","from_date","to_date","unit_price","amount","approveSettlement","storeProfileId","_data$discount_sum","readErr","maybeSingle","ok","message","nowIso","updErr","settled_qty","settled_amount","settled_date"],"sources":["D:/포폴 사용/stay/src/api/adminApi.js"],"sourcesContent":["import  supabase  from \"./supabaseClient\";\n\n    /* =====================================================\n    ✅ 관리자 공통 상수\n    - 여러 API에서 같은 값 쓰면 여기서 통일\n    ===================================================== */\n    const UNIT_PRICE = 1500;\n\n    /* =====================================================\n    관리자 헤더\n    ===================================================== */\n\n    /**\n     * ✅ [관리자 페이지 상단 Header]\n     * - 관리자 이름 표시 (profiles.user_name)\n     * - user_type이 ADMIN인지 체크\n     *\n     * ✅ 사용 예시\n     * const header = await fetchAdminHeader(adminProfileId);\n     * // header.role_label -> \"관리자\"\n     * // header.admin_name -> \"홍길동\"\n     */\n    export const fetchAdminHeader = async (adminProfileId) => {\n    const { data, error } = await supabase\n        .from(\"profiles\")\n        .select(\"id, user_name, user_type\")\n        .eq(\"id\", adminProfileId)\n        .single();\n\n    if (error) throw error;\n\n    // ✅ 안전장치: 관리자 계정만 접근\n    if (data.user_type !== \"ADMIN\") {\n        throw new Error(\"관리자 계정이 아닙니다.\");\n    }\n\n    return {\n        role_label: \"관리자\",\n        admin_name: data.user_name,\n    };\n    };\n\n    /* =====================================================\n    승인요청 리스트 / 승인 처리\n    ===================================================== */\n\n    /**\n     * ✅ [관리자 페이지 - 승인요청 리스트]\n     * - 가입했지만 승인 안 된 사용자 목록\n     * - profiles.is_approved = false 인 행들\n     *\n     * ✅ 사용 예시\n     * const list = await fetchApprovalRequests();\n     * // list.map(card => card.user_name ...)\n     */\n    export const fetchApprovalRequests = async () => {\n    const { data, error } = await supabase\n        .from(\"profiles\")\n        .select(\"id, user_type, user_name, dong_ho, car_num, add_car, is_approved, created_at\")\n        .eq(\"is_approved\", false)\n        .order(\"created_at\", { ascending: false });\n\n    if (error) throw error;\n\n    return (data || []).map((row) => ({\n        profile_id: row.id,\n        user_type: row.user_type,\n        user_name: row.user_name,\n        dong_ho: row.dong_ho,\n        car_num: row.car_num,\n        add_car: row.add_car ?? null,\n        created_at: row.created_at?.slice(0, 10) ?? null, // 날짜만\n    }));\n    };\n\n    /**\n     * ✅ [관리자 페이지 - 승인 버튼]\n     * - 해당 사용자 profiles.is_approved = true 로 변경\n     *\n     * ✅ 사용 예시\n     * await approveProfile(profileId);\n     * // 이후 fetchApprovalRequests() 다시 호출해서 화면 갱신\n     */\n    export const approveProfile = async (profileId) => {\n    const { error } = await supabase\n        .from(\"profiles\")\n        .update({ is_approved: true })\n        .eq(\"id\", profileId);\n\n    if (error) throw error;\n    return true;\n    };\n\n    /* =====================================================\n    상가 정산 리스트 / 정산 승인\n    ===================================================== */\n\n    /**\n     * ✅ [관리자 페이지 - 상가 정산 리스트(카드 여러 개)]\n     * - parking_discounts.discount_sum > 0 인 상가만 보여줌\n     * - (DB에 \"정산요청 상태\" 컬럼이 없어서) 누적이 있으면 '정산 대상'으로 간주\n     *\n     * ✅ 사용 예시\n     * const cards = await fetchAdminSettlementList();\n     * // cards를 map으로 카드 UI 렌더링\n     */\n    export const fetchAdminSettlementList = async () => {\n    const { data, error } = await supabase\n        .from(\"parking_discounts\")\n        .select(\n        `\n        profile_id,\n        discount_sum,\n        created_at,\n        profiles (\n            user_name,\n            user_type\n        )\n        `\n        )\n        .gt(\"discount_sum\", 0); // ✅ 누적 있는 상가만\n\n    if (error) throw error;\n\n    const today = new Date().toISOString().slice(0, 10);\n\n    return (data || [])\n        .filter((r) => r.profiles?.user_type === \"STORE\")\n        .map((r) => {\n        const qty = r.discount_sum ?? 0;\n\n        return {\n            store_profile_id: r.profile_id,\n            store_name: r.profiles?.user_name ?? \"(상가)\",\n            // ✅ DB에 \"기간\"이 없으므로: 최근 created_at(정산일로 사용) ~ 오늘\n            from_date: r.created_at ? r.created_at.slice(0, 10) : null,\n            to_date: today,\n            qty,\n            unit_price: UNIT_PRICE,\n            amount: qty * UNIT_PRICE,\n        };\n        });\n    };\n\n    /**\n     * ✅ [관리자 페이지 - 정산 승인 버튼]\n     * - 승인하면 해당 상가 discount_sum을 0으로 초기화\n     * - created_at을 now로 바꿔서 \"최근 정산일\"처럼 사용\n     *\n     * ✅ 사용 예시\n     * const res = await approveSettlement(storeProfileId);\n     * if(res.ok) alert(\"정산 승인 완료\");\n     * // 이후 fetchAdminSettlementList() 재호출\n     */\n    export const approveSettlement = async (storeProfileId) => {\n    // 1) 현재 누적 조회 (0이면 승인할 게 없음)\n    const { data, error: readErr } = await supabase\n        .from(\"parking_discounts\")\n        .select(\"discount_sum\")\n        .eq(\"profile_id\", storeProfileId)\n        .maybeSingle();\n\n    if (readErr) throw readErr;\n\n    const qty = data?.discount_sum ?? 0;\n    if (qty === 0) {\n        return { ok: false, message: \"정산할 내역이 없습니다.\" };\n    }\n\n    // 2) 정산 처리 (초기화)\n    const nowIso = new Date().toISOString();\n    const { error: updErr } = await supabase\n        .from(\"parking_discounts\")\n        .update({ discount_sum: 0, created_at: nowIso })\n        .eq(\"profile_id\", storeProfileId);\n\n    if (updErr) throw updErr;\n\n    // 3) 관리자 화면에서 보여줄 결과값\n    return {\n        ok: true,\n        settled_qty: qty,\n        settled_amount: qty * UNIT_PRICE,\n        settled_date: nowIso.slice(0, 10),\n    };\n};\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}